(()=>{var t={295:()=>{document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("langSelect");t&&t.addEventListener("change",(()=>{const e=t.value;document.cookie=`bq_locale=${e};path=/;max-age=31536000;SameSite=Lax`,location.reload()}))}))}},e={};function s(i){var a=e[i];if(void 0!==a)return a.exports;var n=e[i]={exports:{}};return t[i](n,n.exports,s),n.exports}(()=>{"use strict";class t{static setup(e=".accordeon"){document.addEventListener("click",(s=>{const i=s.target.closest(`${e} .accordeon-title`);if(!i)return;const a=i.closest(e),n=a.querySelector(".accordeon-content");n&&t.toggle(a,n)}))}static toggle(t,e){if(t.classList.contains("active"))e.style.maxHeight=e.scrollHeight+"px",e.offsetHeight,e.style.maxHeight="0",t.classList.remove("active");else{e.style.maxHeight=e.scrollHeight+"px",t.classList.add("active");const s=()=>{t.classList.contains("active")&&(e.style.maxHeight="none"),e.removeEventListener("transitionend",s)};e.addEventListener("transitionend",s)}}}s(295);class e{static _domains={};static _loaded={};static async load(t){if(!this._loaded[t]){try{const e=await fetch(`/admin/api/locale/domain/get/${t}`);if(!e.ok)throw new Error(`Error for domain: ${t}`);const s=await e.json();return this._domains[t]=s,this._loaded[t]=!0,s}catch(t){console.error(`[Translator] ${t.message}`)}return null}}static async translate(t,e="bugquest",s={}){e=e.trim(),t=t.trim(),this._loaded[e]||await this.load(e);let i=this._domains[e]?.[t]??t;return this._applyReplacements(i,s)}static t(t,e="bugquest",s={}){let i=this._domains[e]?.[t]??t;return this._applyReplacements(i,s)}static _applyReplacements(t,e){return t.replace(/{(.*?)}/g,((t,s)=>e[s]??t))}}function i(t,s="bugquest",i={}){return e.t(t,s,i)}class a{constructor({label:t,options:e,selected:s=null,onChange:i=null,openTop:a=!1,placeholder:n="Sélectionner…",multiple:l=!1}){this.label=t,this.options=e,this.onChange=i,this.openTop=a,this.placeholder=n,this.multiple=l,this.isObjectOption="object"==typeof e[0],this.validValues=e.map((t=>this.isObjectOption?t.value:t)),this.currentValue=l?Array.isArray(s)?s.filter((t=>this.validValues.includes(t))):[]:this.validValues.includes(s)?s:null,this.build()}build(){this.wrapper=n.div("select-wrapper"),this.wrapper.setAttribute("role","listbox"),this.wrapper.tabIndex=0,this.head=n.div("select-head"),this.labelEl=n.div("select-label",this.label),this.valueEl=n.div("select-value"),this.body=n.div("select-body"),this.head.append(this.labelEl,this.valueEl),this.wrapper.append(this.head,this.body),this.renderOptions(),this.updateDisplay(),this.head.addEventListener("click",(()=>this.toggle(!0))),this.wrapper.addEventListener("keydown",(t=>{"Enter"===t.key&&this.toggle(!0),"Escape"===t.key&&this.toggle(!1)})),this.closeHandler=t=>{this.wrapper.contains(t.target)||this.toggle(!1)},document.addEventListener("click",this.closeHandler)}renderOptions(){this.options.forEach((t=>{const e=this.isObjectOption?t.value:t,s=this.isObjectOption?t.label:t,i=n.div("select-item");i.setAttribute("role","option"),i.textContent=s,i.dataset.value=e,this.isSelected(e)&&i.classList.add("active"),this.body.appendChild(i)})),this.body.addEventListener("click",(t=>{if(!t.target.classList.contains("select-item"))return;const e=t.target.dataset.value;if(this.validValues.includes(e)){if(this.multiple){const s=this.currentValue.indexOf(e);s>=0?(this.currentValue.splice(s,1),t.target.classList.remove("active")):(this.currentValue.push(e),t.target.classList.add("active"))}else this.currentValue=e,[...this.body.children].forEach((t=>{t.classList.toggle("active",t.dataset.value===e)})),this.toggle(!1);this.updateDisplay(),this.onChange&&this.onChange(this.getValue())}}))}toggle(t){t?(this.body.style.display="block",this.body.offsetHeight,this.body.classList.add("active"),this.body.style.top=this.openTop?"0":"auto",this.body.style.bottom=this.openTop?"auto":"0"):(this.body.classList.remove("active"),setTimeout((()=>{this.body.classList.contains("active")||(this.body.style.display="none")}),300))}isSelected(t){return this.multiple?this.currentValue.includes(t):this.currentValue===t}updateDisplay(){let t=[];if(this.multiple)t=this.currentValue.map((t=>{const e=this.options.find((e=>this.isObjectOption?e.value===t:e===t));return e?this.isObjectOption?e.label:e:t}));else if(null!==this.currentValue){const e=this.options.find((t=>this.isObjectOption?t.value===this.currentValue:t===this.currentValue));e&&(t=[this.isObjectOption?e.label:e])}this.valueEl.innerText=t.length?t.join(", "):this.placeholder}setValue(t){if(this.multiple){const e=Array.isArray(t)?t:[];this.currentValue=e.filter((t=>this.validValues.includes(t)))}else this.currentValue=this.validValues.includes(t)?t:null;[...this.body.children].forEach((t=>{t.classList.toggle("active",this.isSelected(t.dataset.value))})),this.updateDisplay()}getValue(){return this.multiple?[...this.currentValue]:this.currentValue}getElement(){return this.wrapper}destroy(){document.removeEventListener("click",this.closeHandler)}}class n{static createEl=(t,e,s="")=>{const i=document.createElement(t);return e&&(i.className=e),s&&(i.innerText=s),i};static accordion(t,e){let s=this.div("__accordeon accordeon");e&&s.classList.add(e);let i=this.div("__accordeon_title accordeon-title");i.textContent=t,s.appendChild(i);let a=this.div("__accordeon_content accordeon-content");return s.appendChild(a),{accordeon:s,accordeon_content:a}}static glow_stick(){return this.div("glow-stick")}static label(t="",e=""){return this.createEl("label",e,t)}static input_text(t="",e="",s=""){let i=this.createEl("input",s);return i.type="text",t&&(i.placeholder=t),e&&(i.value=e),i}static textarea(t="",e="",s=""){let i=this.createEl("textarea",s);return e&&(i.value=e),i}static input_number(t="",e=1,s="",i=""){let a=this.createEl("input",i);return a.type="number",e&&(a.step=e),t&&(a.placeholder=t),s&&(a.value=s),a}static input_search(t="",e="",s=null,i=null,a=2){let n=this.input_text(t,"",e);return n.type="search",n.addEventListener("input",(()=>{let t=n.value;t.length>=a?s(t):i()})),n}static input_password(t="",e="",s=""){let i=this.input_text(t,e,s);return i.type="password",i}static checkbox(t="",e=!1,s="",i=null){let a=this.createEl("input","checkbox");a.type="checkbox",e&&(a.checked=!0),i&&a.addEventListener("change",i);let n=this.label(t);return n.prepend(a),n}static switch(t=!1,e=null){let s=this.div("switch");return s.dataset.state=t?"on":"off",s.title=i(t?"Activé":"Désactivé","options"),s.addEventListener("click",(()=>{s.dataset.state="on"===s.dataset.state?"off":"on",s.title="on"===s.dataset.state?i("Activé","options"):i("Désactivé","options"),e&&e("on"===s.dataset.state)})),{element:s,value:()=>"on"===s.dataset.state,toggle:t=>{s.dataset.state=t?"on":"off",s.title=i(t?"Activé":"Désactivé","options")}}}static button_submit(t="Envoyer",e="button button-primary"){let s=this.createEl("button",e,t);return s.type="submit",s}static button(t="Button",e="button",s=null){let i=this.createEl("button",e,t);return s&&i.addEventListener("click",s),i}static div(t=""){return this.createEl("div",t)}static span(t=""){return this.createEl("span",t)}static modal(t="",e=null,s=null){const i=this.div("modal"),a=this.div("modal-wrapper"),n=this.div("modal-close"),l=this.div("modal-content");let o=null;t&&(o=this.div("modal-title"),o.textContent=t,a.appendChild(o)),a.appendChild(n),a.appendChild(l),i.appendChild(a);const c=()=>{i.classList.remove("active"),s&&s()};return n.addEventListener("click",c),i.addEventListener("click",(t=>{t.target===i&&c()})),{element:i,open:()=>{i.classList.add("active"),e&&e()},close:c,title:o??"",content:l}}static h2(t,e=""){return this.createEl("h2",e,t)}static h3(t,e=""){return this.createEl("h3",e,t)}static h4(t,e=""){return this.createEl("h4",e,t)}static img(t,e="",s=""){let i=document.createElement("img");return i.src=t,i.alt=e||Math.random().toString(16).slice(2),s&&(i.className=s),i}static list(t=[],e="",s="",i=null){let a=document.createElement("ul");return e&&(a.className=e),t.forEach((t=>{let e=document.createElement("li");e.innerHTML=t,s&&(e.className=s),i&&e.addEventListener("click",(()=>{i(t)})),a.appendChild(e)})),a}static search(t="Rechercher...",e=null,s=null,i=2,a=!1,l=""){let o=this.div("search-container");l&&o.classList.add(l);let c=this.input_text(t);c.type="search";let r=this.div("search-results "+(a?" open-bottom":"open-top"));return o.appendChild(c),o.appendChild(r),e&&c.addEventListener("input",(()=>{let t=c.value;t.length>=i?e(t):r.innerHTML=""})),s&&r.addEventListener("click",(t=>{let e=t.target.closest(".result-item");if(!e)return;let i=JSON.parse(e.dataset.item);i&&s(i)})),{close:()=>{r.innerHTML="",c.value="",r.classList.remove("active")},clean:()=>{r.innerHTML=""},populate:t=>{for(const[e,s]of Object.entries(t)){const t=n.div("result-item");t.textContent=e,t.dataset.item=JSON.stringify(s),r.appendChild(t)}r.classList.add("active")},addItem:(t,e)=>{const s=n.div("result-item");s.textContent=t,s.dataset.item=JSON.stringify(e),r.appendChild(s),r.classList.contains("active")||r.classList.add("active")},getValue:()=>c.value,setValue:t=>{c.value=t,r.innerHTML=""},element:o}}static select(t,e,s=null,i=null,n=!1,l="Sélectionner…"){return new a({label:t,options:e,selected:s,onChange:i,multiple:!1,placeholder:l})}static selectMultiple(t,e,s=[],i=null,n=!1,l="Aucun"){return new a({label:t,options:e,selected:s,onChange:i,multiple:!0,placeholder:l})}static table(t=[],e=[],s="",i="",a=""){let n=this.createEl("table",s),l=document.createElement("thead"),o=document.createElement("tbody");return t.length>0&&t.forEach((t=>l.appendChild(this.createEl("th",i,t)))),e.length>0&&e.forEach((t=>{let e=this.createEl("tr");t.forEach((t=>{let s=this.createEl("td",a);"object"==typeof t&&null!==t&&"value"in t&&"full"in t?(s.textContent=t.value,s.title=t.full,s.classList.add("truncated")):s.textContent=t,e.appendChild(s)})),o.appendChild(e)})),n.appendChild(l),n.appendChild(o),n}static input_search_list(t,e=[],s=""){const i=this.div("input-wrapper"),a=this.label(t);i.appendChild(a);const n=this.input_text("User-agent: *","",s);i.appendChild(n);const l=document.createElement("datalist");return l.id="list-"+Math.random().toString(36).substr(2,9),n.setAttribute("list",l.id),i.appendChild(l),n.setOptions=t=>{l.innerHTML="",t.forEach((t=>{const e=document.createElement("option");e.value=t,l.appendChild(e)}))},n.getElement=()=>i,n}}class l{static containers=new Map;static show(t,{type:e="info",position:s="top-right",duration:i=4e3,icon:a=null,closable:l=!0}={}){const o=this._getContainer(s),c=n.div(`bq-toast ${e}`);if(a){const t=n.div("bq-toast-icon");t.innerHTML=a,c.appendChild(t)}const r=n.div("bq-toast-message");if(r.innerHTML=t,c.appendChild(r),l){const t=n.div("bq-toast-close");t.innerHTML="✖",t.title="Fermer",t.addEventListener("click",(()=>this._removeToast(c))),c.appendChild(t)}o.appendChild(c),requestAnimationFrame((()=>{c.classList.add("show")})),i>0&&setTimeout((()=>this._removeToast(c)),i)}static success(t){this.show(t,{type:"success",icon:"✅"})}static info(t){this.show(t,{type:"info",icon:"ℹ️"})}static warning(t){this.show(t,{type:"warning",icon:"⚠️"})}static error(t){this.show(t,{type:"danger",icon:"❌"})}static _getContainer(t){if(!this.containers.has(t)){const e=n.div(`bq-toast-container ${t}`);document.body.appendChild(e),this.containers.set(t,e)}return this.containers.get(t)}static _removeToast(t){t.classList.remove("show"),setTimeout((()=>t.remove()),300)}}class o{static panel=null;static isDragging=!1;static offset={x:0,y:0};static async init(){this.panel=n.div("debug-panel");const t=n.h3("Debug Panel"),e=n.div("close-btn");if(e.textContent="x",this.panel.append(t,e),document.body.appendChild(this.panel),!this.panel)return;this.restoreFromStorage(),document.addEventListener("keypress",(t=>{178!==t.which&&64!==t.which||(this.panel.classList.toggle("active"),localStorage.setItem("debugPanelActive",this.panel.classList.contains("active")))}));const s=this.panel.querySelector(".close-btn");s&&s.addEventListener("click",(()=>{this.panel.classList.remove("active"),localStorage.setItem("debugPanelActive",!1)})),this.panel.addEventListener("mousedown",this.startDrag.bind(this)),document.addEventListener("mousemove",this.onDrag.bind(this)),document.addEventListener("mouseup",this.stopDrag.bind(this)),await this.loadMetrics(),this.kvSection=n.div("kv-section"),this.kvWrap=n.div("wrap"),this.panel.appendChild(this.kvSection),this.kvValues={},window.debugPanel=this}static startDrag(t){this.panel.classList.contains("active")&&(this.isDragging=!0,this.offset.x=t.clientX-this.panel.offsetLeft,this.offset.y=t.clientY-this.panel.offsetTop,this.panel.classList.add("dragging"),this.panel.style.transition="none")}static onDrag(t){if(!this.isDragging)return;const e=t.clientX-this.offset.x,s=t.clientY-this.offset.y;this.panel.style.left=`${e}px`,this.panel.style.top=`${s}px`,this.panel.style.bottom="auto",this.panel.style.right="auto",localStorage.setItem("debugPanelPosition",JSON.stringify({x:e,y:s}))}static stopDrag(){this.isDragging&&(this.isDragging=!1,this.panel.classList.remove("dragging"),this.panel.style.transition="")}static restoreFromStorage(){const t=localStorage.getItem("debugPanelActive");this.panel.classList.toggle("active","true"===t);const e=localStorage.getItem("debugPanelPosition");if(e)try{const{x:t,y:s}=JSON.parse(e);this.panel.style.left=`${t}px`,this.panel.style.top=`${s}px`,this.panel.style.bottom="auto",this.panel.style.right="auto"}catch(t){const e=window.innerWidth,s=window.innerHeight,i=(e-this.panel.offsetWidth)/2,a=(s-this.panel.offsetHeight)/2;this.panel.style.left=`${i}px`,this.panel.style.top=`${a}px`,this.panel.style.bottom="auto",this.panel.style.right="auto"}}static addGroup(t,e){const{accordeon:s,accordeon_content:i}=n.accordion(t),a=n.div("wrap");if(i.appendChild(a),this.panel.appendChild(s),Array.isArray(e)){if("queries"===t){const t=["SQL","Bindings","Durée"],s=e.map((t=>{const e=parseFloat(t.time),s=e>=1e3?`${(e/1e3).toFixed(3)} s`:`${e.toFixed(2)} ms`;return[{value:t.query,full:t.query},t.bindings.map((t=>`"${t}"`)).join(", "),s]})),i=e.reduce(((t,e)=>t+parseFloat(e.time)),0),l=i>=1e3?`${(i/1e3).toFixed(3)} s`:`${i.toFixed(2)} ms`,o=n.table(t,s,"debug-table"),c=document.createElement("tfoot"),r=document.createElement("tr"),d=document.createElement("td");d.textContent="Total",d.colSpan=2;const h=document.createElement("td");return h.textContent=l,r.append(d,h),c.appendChild(r),o.appendChild(c),void a.appendChild(o)}e.forEach(((t,e)=>{const s=n.div("debug-line");s.textContent=`${e}: ${JSON.stringify(t)}`,a.appendChild(s)}))}else for(const t in e){const s=e[t],i=n.div("debug-line");i.innerHTML=`${t}: ${s}`,a.appendChild(i)}}static renderQueries(){}static async loadMetrics(){await fetch("/admin/api/debug/metrics").then((t=>t.json())).then((t=>{if(t){if("success"in t&&!t.success)return l.show(i("Erreur lors du chargement des metrics:","admin")+" "+t?.message,{type:"danger",icon:"❌"}),void console.error(i("Erreur lors du chargement des metrics:","admin")+" "+t?.message);for(const e in t)this.addGroup(e,t[e])}}))}static updateValue(t,e){if(this.kvValues)if(this.kvValues[t])this.kvValues[t].textContent=e;else{const s=n.div("debug-line");s.innerHTML=`<strong>${t}</strong>: <span class="debug-value">${e}</span>`,this.kvWrap.appendChild(s),this.kvValues[t]=s.querySelector(".debug-value")}}}document.addEventListener("DOMContentLoaded",(async()=>{await o.init(),t.setup(),await new Promise((t=>setTimeout(t,100))),document.dispatchEvent(new CustomEvent("bqAppLoaded")),console.log("%c[App] JS chargé avec succès 🛠️","color: cyan; font-weight: bold")}))})()})();
//# sourceMappingURL=app.js.map