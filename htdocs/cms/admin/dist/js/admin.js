(()=>{var t={295:()=>{document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("langSelect");t&&t.addEventListener("change",(()=>{const e=t.value;document.cookie=`bq_locale=${e};path=/;max-age=31536000;SameSite=Lax`,location.reload()}))}))},540:()=>{document.addEventListener("click",(function(t){const e=t.target.closest(".__dropdown_toggle"),i=e?.closest(".__dropdown");document.querySelectorAll(".__dropdown").forEach((t=>{t!==i&&t.classList.remove("active")})),i&&i.classList.toggle("active")}))}},e={};function i(a){var s=e[a];if(void 0!==s)return s.exports;var n=e[a]={exports:{}};return t[a](n,n.exports,i),n.exports}(()=>{"use strict";i(540);class t{static setup(e=".accordeon"){document.addEventListener("click",(i=>{const a=i.target.closest(`${e} .accordeon-title`);if(!a)return;const s=a.closest(e),n=s.querySelector(".accordeon-content");n&&t.toggle(s,n)}))}static toggle(t,e){if(t.classList.contains("active"))e.style.maxHeight=e.scrollHeight+"px",e.offsetHeight,e.style.maxHeight="0",t.classList.remove("active");else{e.style.maxHeight=e.scrollHeight+"px",t.classList.add("active");const i=()=>{t.classList.contains("active")&&(e.style.maxHeight="none"),e.removeEventListener("transitionend",i)};e.addEventListener("transitionend",i)}}}i(295);class e{static accordion(t,e){let i=document.createElement("div");i.className="__accordeon accordeon",e&&i.classList.add(e);let a=document.createElement("div");a.className="__accordeon_title accordeon-title",a.textContent=t,i.appendChild(a);let s=document.createElement("div");return s.className="accordeon-content",i.appendChild(s),{accordeon:i,accordeon_content:s}}static glow_stick(){let t=document.createElement("div");return t.className="glow-bar",t}static input_text(t="",e="",i=""){let a=document.createElement("input");return a.type="text",a.placeholder=t,a.value=e,a.className=i,a}static button_submit(t="Envoyer",e="button button-primary"){let i=document.createElement("button");return i.type="submit",i.className=e,i.textContent=t,i}static button(t="Button",e="button",i=null){let a=document.createElement("div");return a.className=e,a.textContent=t,i&&a.addEventListener("click",i),a}static div(t=""){let e=document.createElement("div");return e.className=t,e}static modal(t="",e=null){let i=this.div("modal"),a=this.div("modal-wrapper"),s=this.div("modal-close"),n=this.div("modal-content");return t&&(this.div("modal-title").textContent=t,i.appendChild("titleElement")),a.appendChild(s),a.appendChild(n),i.appendChild(a),s.addEventListener("click",(()=>{i.classList.remove("active"),e&&e()})),i.addEventListener("click",(t=>{t.target===i&&(i.classList.remove("active"),e&&e())})),{modal:i,content:n,close:s}}static h2(t,e=""){let i=document.createElement("h2");return i.className=e,i.textContent=t,i}static h3(t,e=""){let i=document.createElement("h3");return i.className=e,i.textContent=t,i}static img(t,e="",i=""){let a=document.createElement("img");return a.src=t,a.alt=e,i&&(a.className=i),a}static list(t=[],e=""){let i=document.createElement("ul");return i.className=e,t.forEach((t=>{let e=document.createElement("li");e.innerHTML=t,i.appendChild(e)})),i}static search(t="Rechercher...",e=null,i=null,a=2,s=!1){let n=this.div("search-container"),o=this.input_text(t);o.type="search";let d=this.div("search-results "+(s?" open-bottom":"open-top"));return n.appendChild(o),n.appendChild(d),e&&o.addEventListener("input",(()=>{let t=o.value;t.length>=a?e(t,d):d.innerHTML=""})),i&&d.addEventListener("click",(t=>{let e=t.target.closest(".result-item");e&&i(e)})),n.addEventListener("close",(()=>{d.innerHTML="",o.value=""})),{searchContainer:n,results:d}}static input_search(t="",e="",i=null,a=null,s=2){let n=this.input_text(t,"",e);return n.type="search",n.addEventListener("input",(()=>{let t=n.value;t.length>=s?i(t):a()})),n}}class a{static _domains={};static _loaded={};static async load(t){if(!this._loaded[t]){try{const e=await fetch(`/admin/locale/domain/get/${t}`);if(!e.ok)throw new Error(`Error for domain: ${t}`);const i=await e.json();return this._domains[t]=i,this._loaded[t]=!0,i}catch(t){console.error(`[Translator] ${t.message}`)}return null}}static async translate(t,e="bugquest",i={}){e=e.trim(),t=t.trim(),this._loaded[e]||await this.load(e);let a=this._domains[e]?.[t]??t;return this._applyReplacements(a,i)}static t(t,e="bugquest",i={}){let a=this._domains[e]?.[t]??t;return this._applyReplacements(a,i)}static _applyReplacements(t,e){return t.replace(/{(.*?)}/g,((t,i)=>e[i]??t))}}function s(t,e="bugquest",i={}){return a.t(t,e,i)}class n{static show(t=()=>{},i=()=>{},a={}){const n={title:s("Confirmation","admin"),message:s("√ätes-vous s√ªr de vouloir continuer ?","admin"),confirmText:s("Valider","admin"),cancelText:s("Annuler","admin"),confirmClass:"button success",cancelClass:"button danger"},{title:o,message:d,confirmText:r,cancelText:l,confirmClass:c,cancelClass:h}={...n,...a},p=e.div("confirm-title");p.textContent=o;const g=e.div("confirm-overlay"),m=e.div("confirm-box"),u=e.div("confirm-message");u.textContent=d;const v=e.div("confirm-actions"),T=e.button(r,c,(()=>{t(),g.remove()})),y=e.button(l,h,(()=>{i(),g.remove()}));v.append(T,y),m.append(p,u,v),g.appendChild(m),document.body.appendChild(g),setTimeout((()=>g.classList.add("active")),10)}}class o{static containers=new Map;static show(t,{type:e="info",position:i="top-right",duration:a=4e3,icon:s=null,closable:n=!0}={}){const o=this._getContainer(i),d=document.createElement("div");d.className=`bq-toast ${e}`,d.innerHTML=`\n            ${s?`<div class="bq-toast-icon">${s}</div>`:""}\n            <div class="bq-toast-message">${t}</div>\n            ${n?'<button class="bq-toast-close" title="Fermer">‚úñ</button>':""}\n        `,n&&d.querySelector(".bq-toast-close").addEventListener("click",(()=>this._removeToast(d))),o.appendChild(d),requestAnimationFrame((()=>{d.classList.add("show")})),a>0&&setTimeout((()=>this._removeToast(d)),a)}static _getContainer(t){if(!this.containers.has(t)){const e=document.createElement("div");e.className=`bq-toast-container ${t}`,document.body.appendChild(e),this.containers.set(t,e)}return this.containers.get(t)}static _removeToast(t){t.classList.remove("show"),setTimeout((()=>t.remove()),300)}}class d{constructor(t){this.gallery=t,this.waitingTags=[],this.deletionMode=!1,this.new_tag="";const{modal:i,content:a,close:s}=e.modal(null,(()=>{this.gallery.loadPage(),this.waitingTags=[],this.deletionMode=!1,a.innerHTML=""}));this.modal=i,this.modal_content=a,document.body.appendChild(this.modal)}async open(t){if(!t)return;this.waitingTags=t.tags?JSON.parse(JSON.stringify(t.tags)):[],this.deletionMode=!1,this.modal_content.innerHTML="";const i=e.div("media-modal");i.appendChild(this.buildActions(t)),i.appendChild(this.buildPreview(t));const a=e.div("media-modal--info"),s=e.div("media-modal--info-container"),n=e.h2(t.original_name),o=e.div(),d=e.list([`<strong>Type :</strong> ${t.mime_type}`,`<strong>Taille :</strong> ${(t.size/1024).toFixed(1)} ko`,`<strong>Extension :</strong> ${t.extension}`,`<strong>Ajout√© le :</strong> ${new Date(t.created_at).toLocaleDateString("fr-FR")}`]);if(o.appendChild(n),o.appendChild(d),s.appendChild(o),s.appendChild(this.buildTagEditor(t)),a.appendChild(s),t.exif&&"object"==typeof t.exif&&Object.keys(t.exif).length>0){const{accordeon:i,accordeon_content:s}=e.accordion("EXIF","small"),n=e.list(Object.entries(t.exif).map((([t,e])=>`<strong>${t}:</strong> ${"object"==typeof e?JSON.stringify(e):e}`)));n.classList.add("media-modal--exif"),s.appendChild(n),a.appendChild(i)}i.appendChild(a),this.modal_content.appendChild(i),this.modal.classList.add("active")}buildTagUpdateButton(t){const i=e.div("icon info hidden");return i.innerHTML="üíæ",i.dataset.tooltip=s("Mettre √† jour les tags","admin"),i.dataset.tooltipType="info",i.onclick=async()=>{const e=this.waitingTags.map((t=>t.id)).map((t=>`tags[]=${encodeURIComponent(t)}`)).join("&");this.deletionMode=!1,this.tagDeleteBtn.classList.remove("active");try{const i=await fetch(`${this.gallery.apiUrl}/tags/set/${t.id}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e});if(!i.ok)throw new Error(`HTTP ${i.status}`);this.waitingTags.forEach((t=>{"new"in t&&t.new&&delete t.new})),t.tags=JSON.parse(JSON.stringify(this.waitingTags)),this.updateTagList(),this.updateTagButtonVisibility(),o.show(s("Tags mis √† jour","admin"),{type:"success",icon:"‚úÖ",duration:2e3,position:"bottom-right",closable:!0})}catch(t){o.show("[MediaModalViewer] "+s("Erreur mise √† jour des tags :","admin")+" "+t.message,{type:"danger",icon:"‚ö†Ô∏è",duration:5e3,position:"bottom-right",closable:!0}),console.error("[MediaModalViewer] "+s("Erreur mise √† jour des tags :","admin"),t)}},i}buildTagDeleteToggle(t){const i=e.div("icon danger");return i.innerHTML="‚ùå",i.dataset.tooltip=s("Mode suppression","admin"),i.dataset.tooltipType="danger",i.onclick=()=>{if(this.deletionMode=!this.deletionMode,!this.deletionMode){const e=this.waitingTags.filter((t=>"new"in t&&t.new));this.waitingTags=t.tags?JSON.parse(JSON.stringify(t.tags)):[],this.waitingTags.push(...e),this.updateTagList(),this.updateTagButtonVisibility()}i.classList.toggle("active",this.deletionMode)},i}buildAddCategoryButton(t){const i=e.div("icon hidden");return i.innerHTML="‚ûï",i.dataset.tooltip=s("Ajouter une nouvelle cat√©gorie","admin"),i.dataset.tooltipType="info",i.onclick=async()=>{if(this.new_tag&&!(this.new_tag.length<3)&&!this.gallery.tags.find((t=>t.name.toLowerCase()===this.new_tag.toLowerCase())))try{const t=await fetch(`${this.gallery.apiUrl}/tags/add`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"name="+encodeURIComponent(this.new_tag)});if(this.search.dispatchEvent(new Event("close")),this.new_tag="",this.tagAddBtn.classList.add("hidden"),!t.ok)throw new Error(`HTTP ${t.status}`);const e=await t.json();this.gallery.tags.push(e),this.gallery.renderTags(),e.new=!0,this.waitingTags.push(e),this.updateTagList(),this.updateTagButtonVisibility()}catch(t){o.show("[MediaModalViewer] "+s("Erreur d'ajout de tag :","admin")+" "+t.message,{type:"danger",icon:"‚ö†Ô∏è",duration:5e3,position:"bottom-right",closable:!0}),console.error("[MediaModalViewer] "+s("Erreur d'ajout de tag :","admin"),t)}},i}buildTagEditor(t){const i=e.div("media-modal--tags"),a=e.div("media-modal--tags-list"),n=e.div("media-modal--tags-actions");this.tagUpdateBtn=this.buildTagUpdateButton(t),this.tagAddBtn=this.buildAddCategoryButton(t),this.tagDeleteBtn=this.buildTagDeleteToggle(t),n.append(this.tagUpdateBtn,this.tagDeleteBtn,this.tagAddBtn),this.updateTagButtonVisibility=()=>{const e=this.waitingTags.map((t=>t.id)),i=t.tags.map((t=>t.id));e.length!==i.length||e.some((t=>!i.includes(t)))?this.tagUpdateBtn.classList.remove("hidden"):this.tagUpdateBtn.classList.add("hidden")},this.updateTagList=()=>{a.innerHTML="",this.waitingTags.forEach((t=>{const i=e.div("tag");i.textContent=t.name,i.dataset.tag=t.id,t.new&&(i.classList.add("new"),i.dataset.tooltip=s("Cliquez pour supprimer","admin"),i.dataset.tooltipType="info"),i.onclick=()=>{this.deletionMode&&(this.waitingTags=this.waitingTags.filter((e=>e.id!==t.id)),i.remove(),this.updateTagButtonVisibility())},a.appendChild(i)}))},this.updateTagList();const{searchContainer:o,result:d}=e.search(s("Ajouter un tag","admin")+"...",((i,a)=>{this.new_tag=i,a.innerHTML="";const s=this.gallery.tags.filter((e=>e.name.toLowerCase().includes(i.toLowerCase())&&!t.tags.some((t=>t.id===e.id))&&!this.waitingTags.some((t=>t.id===e.id))));s.length?(this.tagAddBtn.classList.add("hidden"),a.classList.add("active")):(this.tagAddBtn.classList.remove("hidden"),a.classList.remove("active")),s.forEach((t=>{const i=e.div("result-item");i.textContent=t.name,i.dataset.tag=t.id,a.appendChild(i)}))}),(t=>{const e=parseInt(t.dataset.tag),i=this.gallery.tags.find((t=>t.id===e));i&&(i.new=!0,this.waitingTags.push(i),o.dispatchEvent(new Event("close")),this.updateTagList(),this.updateTagButtonVisibility())}),2);return this.search=o,i.append(n,a,o),i}buildActions(t){const i=e.div("flex-actions"),a=e.div("icon");a.innerHTML="üì•",a.dataset.tooltip=s("T√©l√©charger","admin"),a.dataset.tooltipType="info",a.onclick=async()=>{const e=await(await fetch("/"+t.path)).blob(),i=URL.createObjectURL(e),a=document.createElement("a");a.href=i,a.download=t.original_name,document.body.appendChild(a),a.click(),document.body.removeChild(a)};const d=e.div("icon");d.innerHTML="üîó",d.dataset.tooltip=s("Ouvrir","admin"),d.dataset.tooltipType="info",d.onclick=()=>window.open("/"+t.path,"_blank");const r=e.div("icon danger");return r.innerHTML="üóëÔ∏è",r.dataset.tooltip=s("Supprimer","admin"),r.dataset.tooltipType="danger",r.onclick=async()=>{n.show((async()=>{try{const e=await fetch(`${this.gallery.apiUrl}/delete/${t.id}`,{method:"DELETE"});if(!e.ok)throw new Error(`HTTP ${e.status}`);this.gallery.loadPage(),o.show(s("M√©dia supprim√©","admin"),{type:"success",icon:"‚úÖ",duration:2e3,position:"bottom-right",closable:!0}),this.close()}catch(t){o.show("[MediaModalViewer] "+s("Erreur suppression m√©dia :","admin")+" "+t.message,{type:"danger",icon:"‚ö†Ô∏è",duration:5e3,position:"bottom-right",closable:!0}),console.error("[MediaModalViewer] "+s("Erreur suppression m√©dia :","admin"),t)}}),(()=>null),{title:s("Supprimer ce m√©dia ?","admin"),message:s("Cette action est irr√©versible. √ätes-vous s√ªr de vouloir continuer ?","admin"),confirmText:s("Supprimer","admin"),cancelText:s("Annuler","admin"),confirmClass:"button danger",cancelClass:"button info"})},i.append(a,d,r),i}buildPreview(t){const i=e.div("media-modal--preview");if(t.mime_type.startsWith("image/"))i.appendChild(e.img("/"+t.path,t.original_name));else if(t.mime_type.startsWith("image/svg")){const a=e.img("/"+t.path,t.original_name);i.appendChild(a)}else{const a=e.div("media-card--icon");a.innerHTML=this.gallery.getIconForMime(t.mime_type),i.appendChild(a)}return i}close(){this.modal.classList.remove("active"),this.modal_content.innerHTML=""}}class r{constructor(t){this.element=t,this.canUpload=!1,this.canModal=!1,this.onClickItem=null,this.canEditTags=!1,this.deletionMode=!1,this.perPage=12,this.selectTags=[],this.tags=[],this.mimeTypes=[],this.forced_mimeTypes=[],this.search="";const e=this.element.dataset.perPage;e&&!isNaN(e)&&(this.perPage=parseInt(e,10));const i=this.element.dataset.canUpload;i&&"true"===i&&(this.canUpload=!0);const a=this.element.dataset.canModal;a&&"true"===a&&(this.canModal=!0);const s=this.element.dataset.canEditTags;s&&"true"===s&&(this.canEditTags=!0);const n=this.element.dataset.forcedMimeTypes;n&&n.length>0&&(this.forced_mimeTypes=n.split(",").map((t=>t.trim()))),this.apiUrl="/admin/medias",this.buildElements(),this.initEvents(),this.loadTags(),this.loadPage()}buildElements(){this.canUpload&&(this.dropZone=e.div("media-dropzone"),this.element.appendChild(this.dropZone));const t=e.div("media-gallery-tags");if(this.element.appendChild(t),this.canEditTags){const{accordeon:i,accordeon_content:a}=e.accordion(s("Ajouter des tags","admin"),"small");t.appendChild(i),t.appendChild(e.glow_stick());const n=e.div("media-gallery-tags-form");a.appendChild(n),this.tag_input=e.input_text(s("Ajouter un tag","admin"),"","small full"),n.appendChild(this.tag_input),this.tag_submit=e.button_submit(s("Ajouter","admin"),"button button-primary"),this.tag_submit.addEventListener("click",(t=>{t.preventDefault(),this.deletionMode=!1,tagDeleteBtn.classList.remove("active"),this.search="",this.updateTags();const e=this.tag_input.value.trim();e&&(this.addTag(e),this.tag_input.value="")})),n.appendChild(this.tag_submit)}const i=e.div("media-gallery-tags-actions");t.appendChild(i);const a=e.input_search(s("Rechercher","admin")+"...","small",(t=>{this.search=t,this.updateTags()}),(()=>{this.search="",this.updateTags()}));if(i.appendChild(a),this.canEditTags){const t=this.buildTagDeleteToggle();i.appendChild(t)}this.tags_content=e.div("media-gallery-tags-content"),t.appendChild(this.tags_content);const n=e.div("fullw");this.element.appendChild(n),this.grid=e.div("media-gallery-content"),n.appendChild(this.grid),this.pagination=e.div("media-gallery-pagination"),n.appendChild(this.pagination),this.canModal&&(this.modal=new d(this))}buildTagDeleteToggle(t){const i=e.div("icon danger");return i.innerHTML="‚ùå",i.dataset.tooltip=s("Mode suppression","admin"),i.dataset.tooltipType="danger",i.onclick=()=>{this.deletionMode=!this.deletionMode,this.deletionMode&&(this.selectTags=[],this.updateTags(),this.loadPage()),i.classList.toggle("active",this.deletionMode)},i}initEvents(){this.pagination.addEventListener("click",(t=>{const e=t.target.closest("span[data-page]");if(e){t.preventDefault();const i=parseInt(e.dataset.page,10);isNaN(i)||this.loadPage(i)}})),this.tags_content.addEventListener("click",(t=>{t.preventDefault();const e=t.target.closest("span[data-tag]");if(!e)return;const i=e.dataset.tag;i&&(this.deletionMode?n.show((async()=>{const t=await fetch(`${this.apiUrl}/tags/delete/${i}`,{method:"DELETE",headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(!t.ok)throw new Error(`HTTP ${t.status}`);await t.json(),e.remove(),this.loadPage(),o.show(s("Tag supprim√© avec succ√®s","admin"),{type:"success",icon:"‚úÖ",duration:5e3,position:"bottom-right",closable:!0})}),(()=>null),{title:s("Supprimer ce tag ?","admin"),message:s("Cette action est irr√©versible. √ätes-vous s√ªr de vouloir continuer ?","admin"),confirmText:s("Supprimer","admin"),cancelText:s("Annuler","admin"),confirmClass:"button danger",cancelClass:"button info"}):(this.selectTags.includes(i)?this.selectTags.splice(this.selectTags.indexOf(i),1):this.selectTags.push(i),this.updateTags(),this.loadPage(1)))})),this.canUpload&&(this.element.addEventListener("dragover",(t=>{t.preventDefault(),this.dropZone.classList.add("active")})),this.element.addEventListener("dragleave",(t=>{null!==t.relatedTarget&&this.dropZone.contains(t.relatedTarget)||this.dropZone.classList.remove("active")})),this.element.addEventListener("drop",(t=>{t.preventDefault(),this.dropZone.classList.remove("active");const e=[...t.dataTransfer.files];for(let t of e)this.uploadFile(t)}))),this.element.addEventListener("click",(t=>{const e=t.target.closest(".__media_card");if(e)try{const t=JSON.parse(e.dataset.media);"function"==typeof this.onClickItem&&this.onClickItem(t),this.canModal&&this.modal.open(t)}catch(t){return o.show(s("Erreur de parsing du m√©dia :","admin")+" "+t.message,{type:"danger",icon:"‚ö†Ô∏è",duration:5e3,position:"bottom-right",closable:!0}),void console.error(s("Erreur de parsing du m√©dia :","admin"),t)}}))}async loadPage(t=1){try{const e=new URLSearchParams;e.set("per_page",this.perPage),this.selectTags.forEach((t=>{e.append("tags[]",t)})),this.forced_mimeTypes&&this.forced_mimeTypes.forEach((t=>{e.append("mime_types[]",t)}));const i=await fetch(`${this.apiUrl}/all/${t}?${e}`);if(!i.ok)throw new Error(`HTTP ${i.status}`);const a=await i.json();this.renderMedia(a.items),this.renderPagination(a.current_page,a.last_page)}catch(t){o.show("[MediaGalleryLoader] "+s("Erreur de chargement des m√©dias :","admin")+" "+t.message,{type:"danger",icon:"‚ö†Ô∏è",duration:5e3,position:"bottom-right",closable:!0}),console.error("[MediaGalleryLoader] "+s("Erreur de chargement des m√©dias :","admin"),t)}}async loadTags(){try{const t=await fetch(`${this.apiUrl}/tags/all`);if(!t.ok)throw new Error(`HTTP ${t.status}`);const e=await t.json();this.tags=e,this.renderTags()}catch(t){o.show("[MediaGalleryLoader] "+s("Erreur de chargement des tags :","admin")+" "+t.message,{type:"danger",icon:"‚ö†Ô∏è",duration:5e3,position:"bottom-right",closable:!0}),console.error("[MediaGalleryLoader] "+s("Erreur de chargement des tags :","admin"),t)}}async addTag(t){try{const e=await fetch(`${this.apiUrl}/tags/add`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"name="+encodeURIComponent(t)});if(!e.ok)throw new Error(`HTTP ${e.status}`);await e.json(),this.loadTags()}catch(t){o.show("[MediaGalleryLoader] "+s("Erreur d'ajout de tag :","admin")+" "+t.message,{type:"danger",icon:"‚ö†Ô∏è",duration:5e3,position:"bottom-right",closable:!0}),console.error("[MediaGalleryLoader] "+s("Erreur d'ajout de tag :","admin"),t)}}renderMedia(t=[]){this.grid.innerHTML="",t.forEach((t=>{const e=this.createMediaCard(t);this.grid.appendChild(e)}))}renderPagination(t,e){this.pagination.innerHTML="";for(let i=1;i<=e;i++){const e=document.createElement("span");e.dataset.page=i,e.textContent=i,i===t&&e.classList.add("active"),this.pagination.appendChild(e)}}renderTags(){this.tags_content.innerHTML="",this.tags.forEach((t=>{const e=document.createElement("span");e.dataset.tag=t.id,e.textContent=t.name,this.tags_content.appendChild(e)}))}updateTags(){this.tags_content.querySelectorAll("span[data-tag]").forEach((t=>{const e=t.dataset.tag;e&&(this.search&&t.classList.toggle("hidden",!t.textContent.toLowerCase().includes(this.search.toLowerCase())),this.selectTags.includes(e)?t.classList.add("active"):t.classList.remove("active"))}))}createMediaCard(t){const e=document.createElement("div");e.className="media-card __media_card",e.dataset.id=t.id;const i=t.mime_type.startsWith("image/");return e.innerHTML=`\n            <div class="media-card--mime">${t.mime_type}</div>\n            <div class="media-card--preview">\n                ${i?`<img src="/${t.path}" alt="${t.original_name}">`:`<div class="media-card--icon">${this.getIconForMime(t.mime_type)}</div>`}\n            </div>\n            <div class="media-card--meta">\n                <div class="name">${t.original_name}</div>\n                <div class="size">${(t.size/1024).toFixed(1)} ko</div>\n            </div>\n        `,e.dataset.media=JSON.stringify(t),e}replaceCardWithMedia(t,e){const i=this.createMediaCard(e);t.replaceWith(i)}getIconForMime(t){return"application/pdf"===t?"üìÑ":"text/plain"===t?"üìÉ":t.startsWith("video/")?"üé•":"üìÅ"}uploadFile(t){const i=new FormData;i.append("file",t);const a=e.div("media-card uploading"),n=e.div("media-card--preview"),o=e.div("progress-bar");n.appendChild(this.getPreviewHTML(t)),a.appendChild(n),a.appendChild(o),this.grid.prepend(a);const d=a.querySelector(".progress-bar"),r=new XMLHttpRequest;r.open("POST",`${this.apiUrl}/upload`),r.upload.onprogress=t=>{const e=Math.floor(t.loaded/t.total*100);d.style.width=e+"%"},r.onload=()=>{if(200===r.status)try{const t=JSON.parse(r.responseText);this.replaceCardWithMedia(a,t)}catch(t){a.innerHTML=`<div class="error">‚ùå ${s("R√©ponse invalide","admin")}</div>`}else a.innerHTML=`<div class="error">‚ùå ${s("Upload √©chou√©","admin")}</div>`},r.onerror=()=>{a.innerHTML=`<div class="error">‚ùå ${s("Erreur r√©seau","admin")}</div>`},r.send(i)}getPreviewHTML(t){if(t.type.startsWith("image/svg"))return e.img(URL.createObjectURL(t),"preview");if(t.type.startsWith("image/"))return e.img(URL.createObjectURL(t),"preview");const i=e.div("media-card--icon");return i.innerHTML=this.getIconForMime(t.type),i}}class l{static currentTarget=null;static setup(){document.addEventListener("mouseover",l.handleMouseOver),document.addEventListener("mouseout",l.handleMouseOut),document.addEventListener("mousemove",l.handleMouseMove)}static handleMouseOver(t){const e=t.target.closest("[data-tooltip]");e&&!e._bqTooltip&&(l.currentTarget=e,l.show(e))}static handleMouseOut(t){const e=t.target.closest("[data-tooltip]");e&&e._bqTooltip&&(e._bqTooltip.remove(),e._bqTooltip=null),l.currentTarget=null}static handleMouseMove(t){l.currentTarget&&l.currentTarget._bqTooltip&&l.move(t,l.currentTarget._bqTooltip)}static show(t){const e=t.dataset.tooltip;if(!e)return;const i=document.createElement("div");i.className="bq-tooltip";const a=t.dataset.tooltipType;a&&i.classList.add(a),i.innerHTML=e,document.body.appendChild(i),t._bqTooltip=i;const s={clientX:0,clientY:0,...window.event};l.move(s,i)}static move(t,e){const i=12,a=t.clientX,s=t.clientY,n=e.getBoundingClientRect(),o=window.innerWidth,d=window.innerHeight;let r=s+i,l=a+i;a+n.width+i>o&&(l=a-n.width-i),s+n.height+i>d&&(r=s-n.height-i),e.style.left=`${l}px`,e.style.top=`${r}px`}}class c{static panel=null;static isDragging=!1;static offset={x:0,y:0};static async init(){this.panel=e.div("debug-panel");const t=e.h3("Debug Panel"),i=e.div("close-btn");if(i.textContent="x",this.panel.append(t,i),document.body.appendChild(this.panel),!this.panel)return;this.restoreFromStorage(),document.addEventListener("keypress",(t=>{178!==t.which&&64!==t.which||(this.panel.classList.toggle("active"),localStorage.setItem("debugPanelActive",this.panel.classList.contains("active")))}));const a=this.panel.querySelector(".close-btn");a&&a.addEventListener("click",(()=>{this.panel.classList.remove("active")})),this.panel.addEventListener("mousedown",this.startDrag.bind(this)),document.addEventListener("mousemove",this.onDrag.bind(this)),document.addEventListener("mouseup",this.stopDrag.bind(this)),await this.loadMetrics()}static startDrag(t){this.panel.classList.contains("active")&&(this.isDragging=!0,this.offset.x=t.clientX-this.panel.offsetLeft,this.offset.y=t.clientY-this.panel.offsetTop,this.panel.classList.add("dragging"),this.panel.style.transition="none")}static onDrag(t){if(!this.isDragging)return;const e=t.clientX-this.offset.x,i=t.clientY-this.offset.y;this.panel.style.left=`${e}px`,this.panel.style.top=`${i}px`,this.panel.style.bottom="auto",this.panel.style.right="auto",localStorage.setItem("debugPanelPosition",JSON.stringify({x:e,y:i}))}static stopDrag(){this.isDragging&&(this.isDragging=!1,this.panel.classList.remove("dragging"),this.panel.style.transition="")}static restoreFromStorage(){const t=localStorage.getItem("debugPanelActive");this.panel.classList.toggle("active","true"===t);const e=localStorage.getItem("debugPanelPosition");if(e)try{const{x:t,y:i}=JSON.parse(e);this.panel.style.left=`${t}px`,this.panel.style.top=`${i}px`,this.panel.style.bottom="auto",this.panel.style.right="auto"}catch(t){const e=window.innerWidth,i=window.innerHeight,a=(e-this.panel.offsetWidth)/2,s=(i-this.panel.offsetHeight)/2;this.panel.style.left=`${a}px`,this.panel.style.top=`${s}px`,this.panel.style.bottom="auto",this.panel.style.right="auto"}}static async loadMetrics(){await fetch("/admin/api/debug/metrics").then((t=>t.json())).then((t=>{for(const i in t){const{accordeon:a,accordeon_content:s}=e.accordion(i),n=e.div("wrap");s.appendChild(n);const o=t[i];for(const t in o){const i=o[t],a=e.div("debug-line");a.innerHTML=`${t}: ${i}`,n.appendChild(a)}this.panel.appendChild(a)}}))}}document.addEventListener("DOMContentLoaded",(async()=>{await a.load("admin"),await c.init(),t.setup(),l.setup(),document.querySelectorAll(".__media_gallery").forEach((t=>{new r(t)})),console.log("%c[Admin] JS charg√© avec succ√®s üõ†Ô∏è","color: cyan; font-weight: bold")}))})()})();
//# sourceMappingURL=admin.js.map